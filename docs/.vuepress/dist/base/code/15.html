<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>requestAnimationFrame基本使用 | 胡潇遥的个人网站</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="胡潇遥的个人网站,个人网，个人博客">
    
    <link rel="preload" href="/assets/css/0.styles.d8260f3c.css" as="style"><link rel="preload" href="/assets/js/app.f82c207c.js" as="script"><link rel="preload" href="/assets/js/2.93809ff7.js" as="script"><link rel="preload" href="/assets/js/25.9ce11f5a.js" as="script"><link rel="prefetch" href="/assets/js/10.2ca38eee.js"><link rel="prefetch" href="/assets/js/11.42f1c0ae.js"><link rel="prefetch" href="/assets/js/12.aabcaa60.js"><link rel="prefetch" href="/assets/js/13.8af2824f.js"><link rel="prefetch" href="/assets/js/14.8de75e84.js"><link rel="prefetch" href="/assets/js/15.a3f15e54.js"><link rel="prefetch" href="/assets/js/16.20e26a4a.js"><link rel="prefetch" href="/assets/js/17.82f0950c.js"><link rel="prefetch" href="/assets/js/18.39c08676.js"><link rel="prefetch" href="/assets/js/19.40a3feae.js"><link rel="prefetch" href="/assets/js/20.8bda7505.js"><link rel="prefetch" href="/assets/js/21.cfa8e473.js"><link rel="prefetch" href="/assets/js/22.419fa50e.js"><link rel="prefetch" href="/assets/js/23.d763208f.js"><link rel="prefetch" href="/assets/js/24.b19c4467.js"><link rel="prefetch" href="/assets/js/26.03b68692.js"><link rel="prefetch" href="/assets/js/27.61e6099d.js"><link rel="prefetch" href="/assets/js/28.f8750c87.js"><link rel="prefetch" href="/assets/js/29.3a991ca2.js"><link rel="prefetch" href="/assets/js/3.10eb3ae8.js"><link rel="prefetch" href="/assets/js/30.e627eaa8.js"><link rel="prefetch" href="/assets/js/31.82fffbbc.js"><link rel="prefetch" href="/assets/js/32.b59d26e7.js"><link rel="prefetch" href="/assets/js/33.a17e6204.js"><link rel="prefetch" href="/assets/js/34.a099926b.js"><link rel="prefetch" href="/assets/js/35.37751d3c.js"><link rel="prefetch" href="/assets/js/36.0ea830d9.js"><link rel="prefetch" href="/assets/js/37.9b8a8530.js"><link rel="prefetch" href="/assets/js/38.be2cf320.js"><link rel="prefetch" href="/assets/js/39.5db3fc34.js"><link rel="prefetch" href="/assets/js/4.f075b801.js"><link rel="prefetch" href="/assets/js/40.5a7073c8.js"><link rel="prefetch" href="/assets/js/41.95aa7683.js"><link rel="prefetch" href="/assets/js/42.2c70dff7.js"><link rel="prefetch" href="/assets/js/43.e0883ce5.js"><link rel="prefetch" href="/assets/js/44.72b32ed7.js"><link rel="prefetch" href="/assets/js/45.2e47e278.js"><link rel="prefetch" href="/assets/js/46.dc5af92a.js"><link rel="prefetch" href="/assets/js/47.e9dac652.js"><link rel="prefetch" href="/assets/js/48.d94badd3.js"><link rel="prefetch" href="/assets/js/49.a7b9f63b.js"><link rel="prefetch" href="/assets/js/5.fbedec26.js"><link rel="prefetch" href="/assets/js/50.060be50c.js"><link rel="prefetch" href="/assets/js/51.679c39bb.js"><link rel="prefetch" href="/assets/js/52.fe632d3d.js"><link rel="prefetch" href="/assets/js/53.b2042fe5.js"><link rel="prefetch" href="/assets/js/54.e9b483f0.js"><link rel="prefetch" href="/assets/js/55.bc5748de.js"><link rel="prefetch" href="/assets/js/56.f29da935.js"><link rel="prefetch" href="/assets/js/57.c4e54788.js"><link rel="prefetch" href="/assets/js/58.f1f7fc6a.js"><link rel="prefetch" href="/assets/js/59.84bfba19.js"><link rel="prefetch" href="/assets/js/6.da9cdfec.js"><link rel="prefetch" href="/assets/js/60.60576c82.js"><link rel="prefetch" href="/assets/js/7.cbe85e67.js"><link rel="prefetch" href="/assets/js/8.8d303f92.js"><link rel="prefetch" href="/assets/js/9.878d7d8d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d8260f3c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">胡潇遥的个人网站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/base/" class="nav-link router-link-active">
  基础知识
</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  leetcode
</a></div><div class="nav-item"><a href="https://github.com/ttshxy/ttshxy.github.io/tree/master" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/base/" class="nav-link router-link-active">
  基础知识
</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  leetcode
</a></div><div class="nav-item"><a href="https://github.com/ttshxy/ttshxy.github.io/tree/master" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/base/" aria-current="page" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/base/code/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/base/code/debounce.html" class="sidebar-link">什么是防抖，应用场景有哪些⭐️</a></li><li><a href="/base/code/throttle.html" class="sidebar-link">什么是节流，应用场景有哪些⭐️</a></li><li><a href="/base/code/01.html" class="sidebar-link">js中为何 0.1+0.2 不等于 0.3，应如何做相等比较</a></li><li><a href="/base/code/02.html" class="sidebar-link">Ajax/Fetch/axios三者有什么区别</a></li><li><a href="/base/code/03.html" class="sidebar-link">TCP 三次握手与四次挥手</a></li><li><a href="/base/code/04.html" class="sidebar-link">for...in与for...of的区别</a></li><li><a href="/base/code/05.html" class="sidebar-link">js严格模式的特点</a></li><li><a href="/base/code/06.html" class="sidebar-link">js跨域</a></li><li><a href="/base/code/07.html" class="sidebar-link">Antd Form.Item控件嵌套</a></li><li><a href="/base/code/08.html" class="sidebar-link">js事件循环体系</a></li><li><a href="/base/code/09.html" class="sidebar-link">for与forEach哪个快</a></li><li><a href="/base/code/10.html" class="sidebar-link">js作用域与闭包</a></li><li><a href="/base/code/11.html" class="sidebar-link">js中的this</a></li><li><a href="/base/code/12.html" class="sidebar-link">js中的原型与原型链</a></li><li><a href="/base/code/13.html" class="sidebar-link">NodeJs commonJs与ES6 import区别</a></li><li><a href="/base/code/14.html" class="sidebar-link">js深拷贝与浅拷贝</a></li><li><a href="/base/code/15.html" aria-current="page" class="active sidebar-link">requestAnimationFrame使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/base/code/16.html" class="sidebar-link">js数组去重</a></li><li><a href="/base/code/17.html" class="sidebar-link">手写js拍平函数flat</a></li><li><a href="/base/code/18.html" class="sidebar-link">url参数匹配</a></li><li><a href="/base/code/19.html" class="sidebar-link">事件捕获与冒泡</a></li><li><a href="/base/code/20.html" class="sidebar-link">Retina 屏 1px 像素问题</a></li><li><a href="/base/code/21.html" class="sidebar-link">前端安全-XSS和CSRF</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂项</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="requestanimationframe基本使用"><a href="#requestanimationframe基本使用" class="header-anchor">#</a> requestAnimationFrame基本使用</h1> <h3 id="你需要知道的requestanimationframe"><a href="#你需要知道的requestanimationframe" class="header-anchor">#</a> 你需要知道的requestAnimationFrame</h3> <p>随着前端的发展，css已经能够实现非常多的动画特效，但是仍然存在css无法完成的动画任务（比如页面滚动），通常的解决方案都是使用js中的setInterval来设置定时器来实现动画特效，比如下面的一个基本的动画循环。</p> <div class="language- extra-class"><pre class="language-text"><code>(function() {
  function updateAnimations() {
    doAnimation1();
    doAnimation2();
  }
  setInterval(updateAnimations, 100);
})();
</code></pre></div><p>该代码实现的功能是每隔100毫秒执行函数操作来达到动画效果，然而，使用计时器真的可靠吗？ 答案当然是 <strong>no</strong></p> <p>由于JavaScript是单线程的，所以定时器的实现是在当前任务队列完成后再执行定时器的回调的，假如当前队列任务执行时间大于定时器设置的延迟时间，那么定时器就不是那么可靠了，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>let startTime = new Date().getTime();
setTimeout(()=&gt;{
  let endTime = new Date().getTime();
  console.log(endTime - startTime);
},50)

for(let i=0;i&lt;20000;i++) {
  console.log(1);
}
</code></pre></div><p>输出如下</p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/2/13/1618f7bc6acd9f5c~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="示例"></p> <p>可以看到，设置了50毫秒后执行，实际执行延迟时间远大于这个数值，这就会导致动画效果并不会达到想要的效果。</p> <hr> <p>动画是由浏览器按照一定的频率一帧一帧的绘制的，由css实现的动画的优势就是浏览器知道动画的开始及每一帧的循环间隔，能够在恰当的时间刷新UI，给用户一种流畅的体验，而setInterval或setTimeout实现的JavaScript动画就没有这么可靠了，因为浏览器压根就无法保证每一帧渲染的时间间隔，一般情况下，每秒平均刷新次数能够达到60帧，就能够给人流畅的体验，即每过 1000/60 毫秒渲染新一帧即可，但从上面的例子知，这一点单靠定时器是无法保证的。 为此，requestAnimationFrame应运而生，其作用就是让浏览器流畅的执行动画效果。可以将其理解为专门用来实现动画效果的api，通过这个api,可以告诉浏览器某个JavaScript代码要执行动画，浏览器收到通知后，则会运行这些代码的时候进行优化，实现流畅的效果，而不再需要开发人员烦心刷新频率的问题了。</p> <p>使用方法如下：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style type=&quot;text/css&quot;&gt;
      #box {
        width: 100px;
        height: 40px;
        background-color: green;
      }
    &lt;/style&gt;
    &lt;script&gt;
      function animationWidth() {
        var div = document.getElementById('box');
        div.style.width = parseInt(div.clientWidth) + 1 + 'px';
        if (parseInt(div.style.width) &lt; 200) {
          requestAnimationFrame(animationWidth);
        }
      }
      function clickFun() {
        animationWidth();
      }
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;box&quot;&gt;&lt;/div&gt;
    &lt;button onclick=&quot;clickFun()&quot;&gt;开始动画&lt;/button&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>效果如下(GIF录制的有点卡。。。实际效果请参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhaolyang.github.io%2FblogBlogBlog%2Fjavascript%2FrequestAnimationFrame%2Fdemo.html" target="_blank" rel="noopener noreferrer">示例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)：</p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/2/13/1618f7bc6acd9f5c~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="示例"></p> <p><strong>requestAnimationFrame做了一部分性能优化，比如浏览器切换Tab时动画会停止</strong></p> <p>可以看到，requestAnimationFrame接受一个动画执行函数作为参数，这个函数的作用是仅执行一帧动画的渲染，并根据条件判断是否结束，如果动画没有结束，则继续调用requestAnimationFrame并将自身作为参数传入。从示例来看，得到了效果平滑流畅的动画，这样就巧妙地避开了每一帧动画渲染的时间间隔问题。</p> <p>requestAnimationFrame的兼容性参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fcaniuse.com%2F%23search%3DrequestAnimationFrame" target="_blank" rel="noopener noreferrer">caniuse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在高级浏览器中，开发人员不用去操心每一帧动画渲染的时间间隔问题，而针对低版本浏览器，则需要使用setTimeout来模拟requestAnimationFrame,且针对不同浏览器对requestAnimationFrame的实现，这个api的名字也略有差异，针对低版本浏览器的模拟requestAnimationFrame的写法如下(来自张鑫旭大神的博客)：</p> <div class="language- extra-class"><pre class="language-text"><code>(function() {
    var lastTime = 0;
    var vendors = ['webkit', 'moz'];
    for(var x = 0; x &lt; vendors.length &amp;&amp; !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||    // Webkit中此取消方法的名字变了
                                      window[vendors[x] + 'CancelRequestAnimationFrame'];
    }

    if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
            var id = window.setTimeout(function() {
                callback(currTime + timeToCall);
            }, timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
    }
    if (!window.cancelAnimationFrame) {
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
    }
}());
复制代码
</code></pre></div><p>具体含义不做解释，如果遇到低版本浏览器的动画需求，你只需要把这段代码丢进去定义一个低配版requestAnimationFrame方法即可（珍爱生命，远离老浏览器啊）。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/base/code/14.html" class="prev">
        js深拷贝与浅拷贝
      </a></span> <span class="next"><a href="/base/code/16.html">
        js数组去重
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f82c207c.js" defer></script><script src="/assets/js/2.93809ff7.js" defer></script><script src="/assets/js/25.9ce11f5a.js" defer></script>
  </body>
</html>
